<div class="cell large-6 xlarge-7 xxlarge-5 xxlarge-offset-1">

  {{structural/project-list-map
    tiles=tiles
    bounds=bounds}}

  <div class="project-filters">
    {{#filter-mutators
      mutateArray=(action 'mutateArray')
      appliedFilters=applied-filters
      as |filters|}}
      {{#filters.section
        filterTitle='Certification Date'
        filterNames='dcp_certifiedreferred'
        as |section|}}
        {{slider-filter
          start=dcp_certifiedreferred
          min=(object-at 0 queryParamsState.dcp_certifiedreferred.defaultValue)
          max=(object-at 1 queryParamsState.dcp_certifiedreferred.defaultValue)
          replaceProperty=(action section.delegate-mutation (action (mut dcp_certifiedreferred)))}}
      {{/filters.section}}

      {{#filters.section
        filterTitle='Project Name / Description / Applicant'
        filterNames='project_applicant_text'
        as |section|}}
         <input
          class="filter-text-input"
          type="text"
          value={{project_applicant_text}}
          oninput={{action section.delegate-mutation (action 'setDebouncedText' 'project_applicant_text')}}>
      {{/filters.section}}

      {{#filters.section
        filterTitle='ULURP / CEQR Number'
        filterNames='ulurp_ceqr_text'
        as |section|}}
         <input
          class="filter-text-input"
          type="text"
          value={{ulurp_ceqr_text}}
          oninput={{action section.delegate-mutation (action 'setDebouncedText' 'ulurp_ceqr_text')}}>
      {{/filters.section}}

      {{#filters.section
        filterTitle='Project Stage'
        filterNames='dcp_publicstatus'
        as |section|}}
        <ul class="menu vertical medium-horizontal stage-checkbox">
          {{#each (array 'Filed' 'In Public Review' 'Complete' 'Unknown') as |type|}}
            <li {{action section.delegate-mutation (action 'mutateArray' 'dcp_publicstatus' type)}}>
              <a>
                {{filter-checkbox
                  value=type
                  currentValues=dcp_publicstatus
                  classPrefix="publicstatus"
                }}
              </a>
            </li>
          {{/each}}
        </ul>
      {{/filters.section}}

      {{#filters.section
        filterTitle='Borough / Block'
        filterNames=(array 'boroughs' 'block')
        as |section|}}
        <ul class="menu vertical medium-horizontal stage-checkbox">
          {{#each (array 'Citywide' 'Manhattan' 'Bronx' 'Brooklyn' 'Queens' 'Staten Island') as |type|}}
            <li {{action section.delegate-mutation (action 'mutateArray' 'boroughs' type)}}>
              <a>
                {{filter-checkbox
                  value=type
                  currentValues=boroughs
                  classPrefix="borough"
                }}
              </a>
            </li>
          {{/each}}
        </ul>
        <input
          class="filter-text-input"
          type="text"
          value={{block}}
          placeholder="Block Number (e.g. '1000')"
          oninput={{action section.delegate-mutation (action 'setDebouncedText' 'block')}}>
      {{/filters.section}}

      {{#filters.section
        filterTitle='Community District'
        filterNames='community-districts'
        as |section|}}
        {{#power-select-multiple
          options=(lookup-community-district)
          selected=(contains-keys
            (lookup-community-district)
            community-districts
            key='code')
          placeholder="Select some names..."
          searchField='searchField'
          onchange=(action section.delegate-mutation (action 'replaceProperty' 'community-districts'))
          as |district|
        }}
          {{district.boro}} {{district.num}}
        {{/power-select-multiple}}
      {{/filters.section}}

      {{#filters.section
        filterTitle='Action Type'
        filterNames='action-types'
        as |section|}}
        {{#power-select-multiple
          options=(lookup-action-type)
          selected=(contains-keys
            (lookup-action-type)
            action-types
            key='code')
          placeholder="Select some actions..."
          searchField='searchField'
          onchange=(action section.delegate-mutation (action 'replaceProperty' 'action-types'))
          as |action|
        }}
          {{action.code}}

          {{#if action.short}}
            - {{action.short}}
          {{/if}}
        {{/power-select-multiple}}
      {{/filters.section}}

      {{#filters.section
        filterTitle='CEQR Type'
        filterNames='dcp_ceqrtype'
        as |section|}}
        <ul class="menu vertical medium-horizontal CEQR-checkbox">
          {{#each (array 'Unlisted' 'Type I' 'Type II') as |type|}}
            <li {{action section.delegate-mutation (action 'mutateArray' 'dcp_ceqrtype' type)}}>
              <a>
                {{filter-checkbox
                  value=type
                  currentValues=dcp_ceqrtype}}
              </a>
            </li>
          {{/each}}
        </ul>
      {{/filters.section}}

      {{#filters.section
        filterTitle='FEMA Flood Zone'
        filterNames=(array 'dcp_femafloodzonea' 'dcp_femafloodzoneshadedx' 'dcp_femafloodzonecoastala' 'dcp_femafloodzonev')
        as |section|}}
        <ul class="menu vertical medium-horizontal FEMA-checkbox">
          <li {{action section.delegate-mutation (action 'toggleBoolean' 'dcp_femafloodzonev')}}>
            {{#filters/named-checkbox
              mainProperty=dcp_femafloodzonev
              label='V'}}
              <sup>
                {{icon-tooltip
                  tip='A portion of the 1% annual chance floodplain subject to high velocity wave action (a breaking wave 3 feet high or larger). V Zones are subject to more stringent building requirements than other zones because of the damaging force of waves.'
                  class="dark-gray"
                }}
              </sup>
            {{/filters/named-checkbox}}
          </li>
          <li {{action section.delegate-mutation (action 'toggleBoolean' 'dcp_femafloodzonecoastala')}}>
            {{#filters/named-checkbox
              mainProperty=dcp_femafloodzonecoastala
              label='Coastal A'}}
              <sup>
                {{icon-tooltip
                  tip='A sub-zone of the A Zone where wave heights are expected to be between 1.5 and 3 feet high. This zone is indicated by the Limit of Moderate Wave Action (LiMWA) line on the latest FEMA FIRMs.'
                  class="dark-gray"
                }}
              </sup>
            {{/filters/named-checkbox}}
          </li>
          <li {{action section.delegate-mutation (action 'toggleBoolean' 'dcp_femafloodzonea')}}>
            {{#filters/named-checkbox
              mainProperty=dcp_femafloodzonea
              label='A'}}
              <sup>
                {{icon-tooltip
                  tip='A portion of the area subject to flooding from the 1% annual chance flood. These areas are not subject to high velocity wave action but are still considered high risk flooding areas. In A Zones, NYC Building Code requires buildings to be elevated or flood-proofed based on the Base Flood Elevation identified on the FEMAâ€™s FIRMs.'
                  class="dark-gray"
                }}
              </sup>
            {{/filters/named-checkbox}}
          </li>
          <li {{action section.delegate-mutation (action 'toggleBoolean' 'dcp_femafloodzoneshadedx')}}>
            {{#filters/named-checkbox
              mainProperty=dcp_femafloodzoneshadedx
              label='Shaded X'}}
              <sup>
                {{icon-tooltip
                  tip='The area of moderate flood risk outside the regulatory 1% annual chance flood but within the limits of the 0.2% annual chance flood level (the 500-year floodplain). There are no current NYC Building Code or FEMA flood insurance purchase requirements for buildings in this zone.'
                  class="dark-gray"
                }}
              </sup>
            {{/filters/named-checkbox}}
          </li>
        </ul>
      {{/filters.section}}

      {{#filters.section
        filterTitle='ULURP'
        filterNames='dcp_ulurp_nonulurp'
        as |section|}}
        <ul class="menu vertical medium-horizontal ULURP-checkbox">
          <li {{action section.delegate-mutation (action 'mutateArray' 'dcp_ulurp_nonulurp' 'ULURP')}}>
            <a>
              {{filter-checkbox
                value='ULURP'
                currentValues=dcp_ulurp_nonulurp}}
            </a>
          </li>
          <li {{action section.delegate-mutation (action 'mutateArray' 'dcp_ulurp_nonulurp' 'Non-ULURP')}}>
            <a>
              {{filter-checkbox
                value='Non-ULURP'
                currentValues=dcp_ulurp_nonulurp}}
            </a>
          </li>
        </ul>
      {{/filters.section}}
    {{/filter-mutators}}

    <div class="filter">
      <p class="text-center no-margin">
        <span
          class="button projects-reset-filters-button small gray text-orange no-margin"
          onClick={{action 'resetAll'}}>
          &nbsp;RESET&nbsp;FILTERS&nbsp;
        </span>
      </p>
    </div>
  </div>
</div>
<div class="cell large-6 xlarge-5 xxlarge-6">
  <div class="results">
    <h3 class="results-header header-medium">
      {{numeral-format fetchData.lastSuccessful.value.meta.total '0,0'}}
      application{{unless (eq fetchData.lastSuccessful.value.meta.total 1) 's'}}
      {{if (eq fetchData.lastSuccessful.value.meta.total 1) 'matches' 'match'}} your filters
      <span class="float-right results-header-count">
        {{#if fetchData.isRunning}}
          {{fa-icon 'spinner' class="fa-spin medium-gray"}}
        {{else}}
           listing 1-{{numeral-format cachedProjects.length '0,0'}}
        {{/if}}
      </span>
    </h3>
    <ul class="results-list no-bullet">
      {{#each cachedProjects as |project|}}
        <li class="grid-x grid-padding-small projects-list-result">
          <div class="cell shrink">
            {{project-list-map-pin project=project}}
          </div>
          <div class="cell auto">
            <h3 class="header-medium no-margin">
              {{#link-to 'show-project' project.id}}
                {{if project.dcp_projectname project.dcp_projectname "No Project Name"}}
              {{/link-to}}
            </h3>
            <p class="no-margin text-small dark-grey">
              <strong>
                {{if project.dcp_applicant project.dcp_applicant "Unknown Applicant"}}
              </strong> &mdash; {{if project.dcp_projectbrief (substring-projectbrief project.dcp_projectbrief) "No Project Brief"}}
            </p>
            <p class="no-margin text-tiny dark-gray">
              <span class="label publicstatus-{{dasherize project.dcp_publicstatus_simp}}">
                {{unless (eq project.dcp_publicstatus_simp 'Unknown') project.dcp_publicstatus_simp "Unknown Status"}}
              </span>
              {{#if project.dcp_borough}}
                <span class="label borough-{{dasherize project.dcp_borough}}">
                  {{project.dcp_borough}}
                </span>
              {{/if}}
              {{#if project.dcp_communitydistricts}}
                <span class="label borough-{{dasherize project.dcp_borough}}">
                  {{project.dcp_communitydistricts}}
                </span>
              {{/if}}
              {{#if project.dcp_ulurp_nonulurp}}
                <span class="label light-gray">
                  {{project.dcp_ulurp_nonulurp}}
                </span>
              {{/if}}
              {{#each project.ulurpnumbers as |ulurpnumber|}}
                <span class="label light-gray">
                  {{ulurpnumber}}
                </span>
              {{/each}}
            </p>
          </div>
        </li>
      {{/each}}
    </ul>

    {{load-more-button
      page=page
      noMoreRecords=noMoreRecords
      task=fetchData}}
  </div>
</div>

{{outlet}}
