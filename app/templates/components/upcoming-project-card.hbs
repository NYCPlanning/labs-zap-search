<div
  class="project-summary-card callout"
  data-test-project-card
>
  <div class="grid-x grid-x-small-gutters">
    <div class="cell large-4 xlarge-5">
      <h3 class="tiny-margin-bottom">
        {{#link-to 'show-project' this.assignment.project.id}}<span data-test-project-profile-button="{{this.assignment.project.id}}">{{this.assignment.project.dcpProjectname}}</span>{{/link-to}}
        <small class="dark-gray display-inline-block">{{this.assignment.project.dcpUlurpNonulurp}}</small>
      </h3>
      <h5 class="applicant">{{this.assignment.project.applicants}}</h5>
      <p>{{this.assignment.project.dcpProjectbrief}}</p>
    </div>
    <div class="cell medium-4 large-3 xlarge-2">
      <div class="text-center medium-margin-right medium-margin-left">
        {{#if (eq this.assignment.project.dcpPublicstatusSimp 'In Public Review')}}
          <p class="tiny-margin-bottom">
            {{participant-type-label this.assignment.dcpLupteammemberrole}} Review Begins
          </p>
          <p class="lead">
            <strong
              data-test-time-remaining
            >
              <DateDisplay
                @date={{this.assignment.upcomingMilestonePlannedStartDate}}
                @outputFormat="M/D/YYYY"
              />
            </strong>
          </p>
        {{else}}
          <p class="tiny-margin-bottom">
            Public Review Begins
          </p>
          <p class="lead">
            <strong
              data-test-fuzzy-time-remaining
            >
              {{#if (not (eq isMoreThanThirtyDaysBeforePublicReview null))}}
                {{if isMoreThanThirtyDaysBeforePublicReview 'in more than 30 days' 'in fewer than 30 days'}}
              {{/if}}
            </strong>
          </p>
        {{/if}}
        <p class="text-center text-tiny">
          (Estimated Start Date)
        </p>
      </div>
    </div>
    <div class="cell medium-auto">
      {{#if this.assignment.hearingsNotSubmittedNotWaived}}
        <div class="grid-x">
          <div class="cell medium-auto">
            <LinkTo
              @route="my-projects.assignment.hearing.add"
              @model={{this.assignment}}
              class="button expanded"
              data-test-button="submitHearing"
            >
              {{fa-icon 'calendar' fixedWidth=true size="lg" transform="left-2"}}
              Post {{participant-type-label this.assignment.dcpLupteammemberrole}} Hearing Notice
            </LinkTo>
          </div>
          <div class="cell medium-shrink">
            <button
              class="button expanded gray"
              onClick={{action "openOptOutHearingPopup"}}
              data-test-button="optOutHearingOpenPopup"
            >
              {{fa-icon 'calendar-times' size="lg" transform="shrink-5 down-1"}}
              <small>Opt Out</small>
            </button>
            {{waive-hearings-popup assignment=this.assignment showPopup=showPopup}}
          </div>
        </div>
      {{else}}
        {{#if assignment.hearingsWaived}}
          <span class="opt-out-notice" data-test-hearings-waived-message="{{assignment.project.id}}">
            {{fa-icon 'calendar-times' size="lg" transform="left-2"}}
            You've opted out of posting a hearing
          </span>
        {{/if}}
      {{/if}}
      <ul class="no-bullet no-margin">
        {{#each this.assignment.assigneeDisplayMilestones as |milestone idx|}}
          {{#if (eq idx 1)}}
            <li class="small-margin-bottom">
              <LinkTo
                @route='show-project'
                @model={{milestone.project.id}}
                data-test-button='submitHearing'
              >
                {{fa-icon 'ellipsis-v' fixedWidth=true class="tiny-margin-right"}}
                <span class="text-tiny">VIEW FULL TIMELINE</span>
              </LinkTo>
            </li>
          {{/if}}
          <li class="grid-x small-margin-bottom" data-test-milestone-view="true" data-test-milestone-id={{milestone.id}} data-test-display-order={{idx}}>
            <div class="cell shrink small-margin-right">
              {{#if (eq milestone.statuscode "Completed")}}
                {{fa-icon 'check' class='blue' fixedWidth=true}}
              {{else if (eq milestone.statuscode "In Progress")}}
                {{fa-icon 'hourglass-half' class='blue' fixedWidth=true}}
              {{else if (eq milestone.statuscode "Overridden")}}
                {{fa-icon 'times' class='red-muted' fixedWidth=true}}
              {{else if (eq milestone.statuscode "Not Started")}}
                <span data-test={{if (string-includes milestone.displayName "Review") "upcoming-indicator"}}>
                  {{fa-icon 'calendar' class='light-gray' fixedWidth=true}}
                </span>
              {{/if}}
            </div>
            <div class="cell auto {{if (eq milestone.statuscode "Not Started") 'gray'}}">
              <strong>{{milestone.displayName}}</strong>
              {{#if milestone.dcpActualenddate}}
                <small class="display-inline-block">
                  <DateDisplay
                    @date={{milestone.dcpActualenddate}}
                  />
                </small>
              {{/if}}
              {{#hearings-list-for-milestones-list milestone=milestone as |milestoneParticipants|}}
                {{#each milestoneParticipants as |milestoneParticipant|}}
                  {{#if milestoneParticipant.hearingsSubmitted}}
                    <strong data-test-lup-full-name="{{milestoneParticipant.landUseParticipantFullName}}">
                      {{milestoneParticipant.landUseParticipantFullName}} Public Hearing
                    </strong>
                    {{#deduped-hearings-list dispositions=milestoneParticipant.userDispositions as |dedupedHearings|}}
                      {{#each dedupedHearings as |hearing|}}
                        <ul class="sub-milestones no-bullet">
                          <li class="grid-x">
                            <div class="cell shrink small-margin-right">
                              {{#if (is-before hearing.disposition.dcpDateofpublichearing)}}
                                {{fa-icon 'calendar' fixedWidth=true class='light-gray'}}
                              {{else}}
                                {{fa-icon 'check' fixedWidth=true class='blue-muted'}}
                              {{/if}}
                            </div>
                            <div class="cell auto">
                              <span data-test-hearing-location="{{hearing.disposition.id}}">{{hearing.disposition.dcpPublichearinglocation}}</span>
                              <small class="display-inline-block" data-test-hearing-date="{{hearing.disposition.id}}">
                                <DateDisplay
                                  @date={{hearing.disposition.dcpDateofpublichearing}}
                                  @outputFormat="LLL"
                                />
                              </small>
                              <span class="display-inline-block text-tiny">
                                {{#each hearing.hearingActions as |action index|}}
                                  <span class="label light-gray tiny-margin-bottom tiny-margin-right" data-test-hearing-actions-list="{{hearing.disposition.id}}{{index}}">
                                    {{action.dcpName}}
                                    <small>{{action.dcpUlurpnumber}}</small>
                                  </span>
                                {{/each}}
                              </span>
                            </div>
                          </li>
                        </ul>
                      {{/each}}
                    {{/deduped-hearings-list}}
                  {{/if}}
                {{/each}}
              {{/hearings-list-for-milestones-list}}
            </div>
          </li>
        {{/each}}
      </ul>
    </div>
  </div>
</div>
