<div class="cell shrink">
  {{#if (eq tense "past")}}
    <span class="milestone-icon fa-layers fa-fw">
      {{fa-icon 'circle' fixedWidth=true class='dark-gray'}}
      {{fa-icon 'check' fixedWidth=true class='blue-light' transform='shrink-6'}}
    </span>
  {{else if (eq tense "present")}}
    <span class="milestone-icon fa-layers fa-fw">
      {{fa-icon 'circle' fixedWidth=true class='green-dark'}}
      {{fa-icon 'calendar' prefix='far' fixedWidth=true class='white-smoke' transform='shrink-8'}}
    </span>
  {{else}}
    <span class="milestone-icon fa-layers fa-fw">
      {{fa-icon 'circle' fixedWidth=true class='light-gray'}}
      {{fa-icon 'calendar' prefix='far' fixedWidth=true class='off-white' transform='shrink-8'}}
    </span>
  {{/if}}
</div>
<div class="cell auto {{if (or (eq tense 'past') (eq tense 'present')) '' 'gray'}}">
  <h5 class="no-margin">
    {{milestone.orderSensitiveName}}

    {{#if milestone.displayDescription}}
      <sup class="gray">
        {{icon-tooltip tip=milestone.displayDescription}}
      </sup>
    {{/if}}
  </h5>
  {{#if milestone.displayDate}}
    <p class="milestone-dates">

      {{#if milestone.displayDate}}
        {{moment-format milestone.displayDate "MMMM D" }}
        {{~unless (and milestone.displayDate2 (is-same milestone.displayDate milestone.displayDate2 precision="year"))
          (moment-format milestone.displayDate ", YYYY")}}
      {{/if}}
      {{#if milestone.displayDate2}}
        &ndash;
        {{unless (is-same milestone.displayDate milestone.displayDate2 precision="month")
          (moment-format milestone.displayDate2 "MMMM")}}
        {{moment-format milestone.displayDate2 "D, YYYY" }}
      {{/if}}
    {{#if milestone.dcpMilestoneoutcome}} <span class="label dark-gray" style="font-size: 0.7rem;">{{milestone.dcpMilestoneoutcome}}</span> {{/if}}
    </p>

    {{#if currentMilestoneDispositions}}
      {{#if hearingsSubmitted}}
        <h6>Public Hearings:</h6>
        {{#deduped-hearings-list dispositions=currentMilestoneDispositions subMilestone=true as |dedupedHearings|}}
          {{#each dedupedHearings as |disposition|}}
            {{log "beep" disposition.milestoneHearingActions}}
              <ul class="sub-milestones no-bullet">
                <li class="grid-x">
                  <div class="cell shrink small-margin-right">
                    {{#if (is-before disposition.dcpDateofpublichearing)}}
                      {{fa-icon 'calendar' fixedWidth=true class='light-gray'}}
                    {{else}}
                      {{fa-icon 'check' fixedWidth=true class='blue-muted'}}
                    {{/if}}
                  </div>
                  <div class="cell auto">
                    <strong>{{disposition.dcpPublichearinglocation}}</strong>
                    <small class="datetime">{{~moment-format hearing.dcpDateofpublichearing "LLL"~}}</small>
                    <span class="display-block text-tiny">
                      {{#each disposition.milestoneHearingActions as |action index|}}
                        {{if (gt index 0) ", "}}{{action.dcpName}}
                      {{/each}}
                    </span>
                  </div>
                </li>
              </ul>
            {{/each}}
          {{/deduped-hearings-list}}
        {{/if}}
        {{#if hearingsWaived}}
          <p class="text-small">Hearings have been waived for this milestone.</p>
        {{/if}}
        {{#if votesSubmitted}}
          <h6>Vote:</h6>
          {{#deduped-votes-list dispositions=currentMilestoneDispositions participantRecommendation='participantRecommendation' as |dedupedVotes|}}
            {{#each dedupedVotes as |disposition|}}
              <ul class="sub-milestones no-bullet">
                <li class="grid-x">
                  <div class="cell shrink small-margin-right">
                    {{#if (or (eq disposition.participantRecommendation 'Approved') (eq disposition.participantRecommendation 'Approved with Modifications/Conditions'))}}
                      {{fa-icon 'thumbs-up' fixedWidth=true class='green-muted'}}
                    {{else if (or (eq disposition.participantRecommendation 'Disapproved') (eq disposition.participantRecommendation 'Disapproved with Modifications/Conditions'))}}
                      {{fa-icon 'thumbs-down' fixedWidth=true class='red-muted'}}
                    {{else if (eq disposition.participantRecommendation 'Waived')}}
                      {{fa-icon 'comment-slash' fixedWidth=true class='light-gray'}}
                    {{/if}}
                  </div>
                  <div class="cell auto">
                    <strong>
                      {{!-- if this isn't deduped all actions, show the action and a ":" before the counts --}}
                      <span class="display-inline-block">{{disposition.dcpVotinginfavorrecommendation}} In Favor,</span>
                      <span class="display-inline-block">{{disposition.dcpVotingagainstrecommendation}} Against,</span>
                      <span class="display-inline-block">{{disposition.dcpVotingabstainingonrecommendation}} Abstain</span>
                    </strong>
                    <small class="datetime">{{~moment-format disposition.dcpDateofvote "LL"~}}</small>
                    <span class="display-block text-tiny">
                      {{#each disposition.voteActions as |action index|}}
                        {{if (gt index 0) ", "}}{{action.dcpName}}
                      {{/each}}
                    </span>
                  </div>
                </li>
              </ul>
            {{/each}}
          {{/deduped-votes-list}}
        {{/if}}
      {{/if}}

    {{#if milestone.milestoneoutcome}}
      <span class="label dark-gray" style="font-size: 0.7rem;">{{milestone.milestoneoutcome}}</span>
    {{/if}}

    <ul class="milestone-links">
      {{#if (eq milestone.dcpMilestone "9e3beec4-dad0-e711-8116-1458d04e2fb8")}}
        <li><a href="https://www1.nyc.gov/site/planning/about/commission-meetings.page" target="_blank">{{fa-icon "external-link-alt"}} CPC Public Meeting Calendar</a></li>
      {{/if}}
      {{#if (eq milestone.dcpMilestone "a43beec4-dad0-e711-8116-1458d04e2fb8")}}
        <li><a href="http://a030-cpc.nyc.gov/html/cpc/index.aspx" target="_blank">{{fa-icon "external-link-alt"}} CPC Reports</a></li>
      {{/if}}
      {{#each milestone.milestoneLinks as |link|}}
        <li><a href="{{link.url}}" target="_blank">{{link.filename}}</a></li>
      {{/each}}
    </ul>
  {{/if}}
</div>

{{yield}}
